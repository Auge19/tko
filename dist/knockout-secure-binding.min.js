/*! knockout-secure-binding - v0.0.6 - 2013-12-13
 *  https://github.com/brianmhunt/knockout-secure-binding
 *  Copyright (c) 2013 Brian M Hunt; License: MIT */
!function(a){"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko)}(function(a,b){function c(b){new a.bindingProvider;b=b||{},this.attribute=b.attribute||"data-sbind",this.globals=b.globals||{},this.virtualAttribute=b.virtualAttribute||"ksb ",this.bindings=b.bindings||a.bindingHandlers}function d(b){a.utils.extend(this.bindings,b)}function e(a){var b,c;return a.nodeType===a.ELEMENT_NODE?b=a.getAttribute(this.attribute):a.nodeType===a.COMMENT_NODE&&(c=""+a.nodeValue||a.text,b=c.indexOf(this.virtualAttribute)>-1),b}function f(a,b){var c,d={};return a.nodeType===a.ELEMENT_NODE&&(c=a.getAttribute(this.attribute)),c&&(d=new g(a,b,this.globals).parse(c)),d}var g=function(){function b(a,b,c){this.node=a,this.context=b,this.globals=c||{}}var c={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=(new RegExp("[_A-Za-z]"),new RegExp("_A-Za-z0-9]"),new RegExp("_A-Za-z]"),new RegExp("_A-Za-z0-9.]"),{id:function(a,b){return b?b[a]:void 0},fn:function(a,b){return b?b[a]():void 0}});return b.prototype.white=function(){for(var a=this.ch;a&&" ">=a;)a=this.next();return a},b.prototype.next=function(a){return a&&a!==this.ch&&this.error("Expected '"+a+"' but got '"+this.ch+"'"),this.ch=this.text.charAt(this.at),this.at+=1,this.ch},b.prototype.error=function(a){throw{name:"SyntaxError",message:a,at:this.at,text:this.text}},b.prototype.name=function(){var a="";for(this.white(),ch=this.ch;ch;){if(":"===ch||" "===ch)return a;a+=ch,ch=this.next()}return a},b.prototype.number=function(){var a,b="",c=this.ch;for("-"===c&&(b="-",c=this.next("-"));c>="0"&&"9">=c;)b+=c,c=this.next();if("."===c)for(b+=".",c=this.next();c&&c>="0"&&"9">=c;)b+=c,c=this.next();if("e"===c||"E"===c)for(b+=c,c=this.next(),("-"===c||"+"===c)&&(b+=c,c=this.next());c>="0"&&"9">=c;)b+=c,c=this.next();return a=+b,isFinite(a)?a:(error("Bad number"),void 0)},b.prototype.object=function(){var a,b={},c=this.ch;if("{"===c){if(this.next("{"),c=this.white(),"}"===c)return c=this.next("}"),b;for(;c;){if(a='"'===c||"'"===c?this.string():this.name(),this.white(),c=this.next(":"),Object.hasOwnProperty.call(b,a)&&this.error('Duplicate key "'+a+'"'),b[a]=this.value(),c=this.white(),"}"===c)return c=this.next("}"),b;this.next(","),c=this.white()}}this.error("Bad object")},b.prototype.read_string=function(a){for(var b,d,e,f="",g=this.next();g;){if(g===a)return g=this.next(),f;if("\\"===g)if(g=this.next(),"u"===g){for(e=0,d=0;4>d&&(b=parseInt(g=this.next(),16),isFinite(b));d+=1)e=16*e+b;f+=String.fromCharCode(e)}else{if("string"!=typeof c[g])break;f+=c[g]}else f+=g;g=this.next()}this.error("Bad string")},b.prototype.string=function(){var a=this.ch;return'"'===a?this.read_string('"'):"'"===a?this.read_string("'"):(this.error("Bad string"),void 0)},b.prototype.array=function(){var a=[],b=this.ch;if("["===b){if(b=this.next("["),this.white(),"]"===b)return b=this.next("]"),a;for(;b;){if(a.push(this.value()),b=this.white(),"]"===b)return b=this.next("]"),a;this.next(","),b=this.white()}}this.error("Bad array")},b.prototype.value=function(){var a;switch(this.white(),a=this.ch){case"{":return this.object();case"[":return this.array();case'"':case"'":return this.string();case"-":return this.number();default:return a>="0"&&"9">=a?this.number():this.identifier()}},b.prototype.get_lookup_root=function(a,b){var c=this.context,d=this.node;return"$context"===a?(b.shift(),c):"$element"===a?(b.shift(),d):c&&c.$data&&Object.hasOwnProperty.call(c.$data,a)?c.$data:c&&Object.hasOwnProperty.call(c,a)?c:this.globals},b.prototype.make_accessor=function(a){function b(){var a=f(e[0].name,e);return e.forEach(function(b){a=b.execute(b.name,a)}),a}var c=a.split("."),e=[],f=this.get_lookup_root.bind(this);return c.forEach(function(a){var b,c,f=a.length;"()"==a.substr(f-2)?(b=a.slice(0,f-2),c="fn"):(b=a,c="id"),e.push({name:b,execute:d[c]})}),b},b.prototype.lookup=function(a){switch(a){case"true":return!0;case"false":return!1;case"null":return null;case"undefined":return void 0}return this.make_accessor(a)},b.prototype.identifier=function(){var a="",b=this.ch;for(this.white();b;){if(":"===b||"}"===b||","===b||" "===b||"]"===b)return this.lookup(a);a+=b,b=this.next()}return this.lookup(a)},b.prototype.bindings=function(){for(var a,b={},c=this.ch;c;)a=this.name(),this.white(),c=this.next(":"),b[a]=this.value(),this.white(),c=this.ch?this.next(","):"";return b},b.prototype.convert_to_accessors=function(b){return a.utils.objectForEach(b,function(a,c){"function"!=typeof c&&(b[a]=function(){return c})}),b},b.prototype.parse=function(a){return this.text=a,this.at=0,this.ch=" ",result=this.bindings(),this.white(),this.ch&&this.error("Syntax Error"),this.convert_to_accessors(result)},b}();return a.utils.extend(c.prototype,{registerBindings:d,nodeHasBindings:e,getBindingAccessors:f,Parser:g}),b||(a.secureBindingsProvider=c),c});