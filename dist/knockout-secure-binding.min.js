/*! knockout-secure-binding - v0.0.9 - 2014-1-27
 *  https://github.com/brianmhunt/knockout-secure-binding
 *  Copyright (c) 2014 Brian M Hunt; License: MIT */
!function(a){"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko)}(function(a,b,c){function d(b){new a.bindingProvider;b=b||{},this.attribute=b.attribute||"data-sbind",this.globals=b.globals||{},this.virtualAttribute=b.virtualAttribute||"ksb ",this.bindings=b.bindings||a.bindingHandlers}function e(b){a.utils.extend(this.bindings,b)}function f(a){var b,c;return a.nodeType===a.ELEMENT_NODE?b=a.getAttribute(this.attribute):a.nodeType===a.COMMENT_NODE&&(c=""+a.nodeValue||a.text,b=c.indexOf(this.virtualAttribute)>-1),b}function g(a,b){var c,d={};return a.nodeType===a.ELEMENT_NODE&&(c=a.getAttribute(this.attribute)),c&&(d=new h(a,b,this.globals).parse(c)),d}var h=function(){function b(a,b,c){this.node=a,this.context=b,this.globals=c||{}}var d={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},e={id:function(a,b){return b?b[a]:void 0},fn:function(a,b){return b?b[a]():void 0}},f={"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"+":function(a,b){return a+b},"-":function(a,b){return a-b},"<":function(a,b){return b>a},"<=":function(a,b){return b>=a},">":function(a,b){return a>b},">=":function(a,b){return a>=b},"in":function(a,b){return a in b},"instanceof":function(a,b){return a instanceof b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b}};return f["*"].precedence=5,f["/"].precedence=5,f["%"].precedence=5,f["+"].precedence=6,f["-"].precedence=6,f["<"].precedence=8,f["<="].precedence=8,f[">"].precedence=8,f[">="].precedence=8,f["in"].precedence=8,f["instanceof"].precedence=8,f["=="].precedence=9,f["!="].precedence=9,f["==="].precedence=9,f["!=="].precedence=9,f["&&"].precedence=13,f["||"].precedence=14,b.operators=f,b.prototype.white=function(){for(var a=this.ch;a&&" ">=a;)a=this.next();return a},b.prototype.next=function(a){return a&&a!==this.ch&&this.error("Expected '"+a+"' but got '"+this.ch+"'"),this.ch=this.text.charAt(this.at),this.at+=1,this.ch},b.prototype.error=function(a){throw{name:"SyntaxError",message:a,at:this.at,text:this.text}},b.prototype.name=function(){var a="";for(this.white(),ch=this.ch;ch;){if(":"===ch||" "===ch)return a;a+=ch,ch=this.next()}return a},b.prototype.number=function(){var a,b="",c=this.ch;for("-"===c&&(b="-",c=this.next("-"));c>="0"&&"9">=c;)b+=c,c=this.next();if("."===c)for(b+=".",c=this.next();c&&c>="0"&&"9">=c;)b+=c,c=this.next();if("e"===c||"E"===c)for(b+=c,c=this.next(),("-"===c||"+"===c)&&(b+=c,c=this.next());c>="0"&&"9">=c;)b+=c,c=this.next();return a=+b,isFinite(a)?a:(error("Bad number"),void 0)},b.prototype.object_add_value=function(a,b,c){"function"!=typeof c?a[b]=c:Object.defineProperty(a,b,{get:function(){return c()},enumerable:!0})},b.prototype.object=function(){var a,b={},c=this.ch;if("{"===c){if(this.next("{"),c=this.white(),"}"===c)return c=this.next("}"),b;for(;c;){if(a='"'===c||"'"===c?this.string():this.name(),this.white(),c=this.next(":"),Object.hasOwnProperty.call(b,a)&&this.error('Duplicate key "'+a+'"'),this.object_add_value(b,a,this.expression()),c=this.white(),"}"===c)return c=this.next("}"),b;this.next(","),c=this.white()}}this.error("Bad object")},b.prototype.read_string=function(a){for(var b,c,e,f="",g=this.next();g;){if(g===a)return g=this.next(),f;if("\\"===g)if(g=this.next(),"u"===g){for(e=0,c=0;4>c&&(b=parseInt(g=this.next(),16),isFinite(b));c+=1)e=16*e+b;f+=String.fromCharCode(e)}else{if("string"!=typeof d[g])break;f+=d[g]}else f+=g;g=this.next()}this.error("Bad string")},b.prototype.string=function(){var a=this.ch;return'"'===a?this.read_string('"'):"'"===a?this.read_string("'"):(this.error("Bad string"),void 0)},b.prototype.array=function(){var a=[],b=this.ch;if("["===b){if(b=this.next("["),this.white(),"]"===b)return b=this.next("]"),a;for(;b;){if(a.push(this.expression()),b=this.white(),"]"===b)return b=this.next("]"),a;this.next(","),b=this.white()}}this.error("Bad array")},b.prototype.value=function(){var a;switch(this.white(),a=this.ch){case"{":return this.object();case"[":return this.array();case'"':case"'":return this.string();case"-":return this.number();default:return a>="0"&&"9">=a?this.number():this.identifier()}},b.prototype.get_lookup_root=function(a,b){var c=this.context,d=this.node;return"$context"===a?(b.shift(),c):"$element"===a?(b.shift(),d):c&&c.$data&&Object.hasOwnProperty.call(c.$data,a)?c.$data:c&&Object.hasOwnProperty.call(c,a)?c:this.globals},b.prototype.make_accessor=function(b){function c(){var b=h(g[0].name,g);return g.forEach(function(a){b=a.execute(a.name,b)}),"undefined"==typeof f?b:f?!a.unwrap(b):a.unwrap(b)}for(var d=b.split("."),f=void 0,g=[],h=this.get_lookup_root.bind(this);"!"===d[0][0];)f=!f,d[0]=d[0].substring(1);return d.forEach(function(a){var b,c,d=a.length;"()"===a.substr(d-2)?(b=a.slice(0,d-2),c="fn"):(b=a,c="id"),g.push({name:b,execute:e[c]})}),c},b.prototype.lookup=function(a){switch(a){case"true":return!0;case"false":return!1;case"null":return null;case"undefined":return void 0;default:return this.make_accessor(a)}},b.prototype.infix_operator=function(){for(var a,b="",c=this.white();c&&" "!=c;)b+=c,c=this.next();return a=f[b],a||this.error("Bad operator: '"+b+"'."),a},b.prototype.make_expression_accessor=function(b){function c(b){var d,e;return"function"==typeof b?a.unwrap(b()):"object"!=typeof b?b:(d=b.lhs,e=b.rhs,d&&e&&b.op?b.op(c(d),c(e)):b)}function d(){return c(b)}return d},b.prototype.expression_nodes_to_tree=function(a){var b,c,d,e;for(c=b={lhs:a.shift(),op:a.shift(),rhs:a.shift()};a;){if(d=a.shift(),e=a.shift(),!d)return b;d.precedence>b.op.precedence?(b={lhs:b,op:d,rhs:e},c=b):(c.rhs={lhs:c.rhs,op:d,rhs:e},c=c.rhs)}return b},b.prototype.expression=function(){for(var a=[],b=this.white();b&&("("===b?(this.next(),a.push(this.expression()),this.next(")")):a.push(this.value()),b=this.white(),":"!==b&&"}"!==b&&","!==b&&"]"!==b&&")"!==b&&""!==b);)op=this.infix_operator(),op&&a.push(op),b=this.white();return 0===a.length?c:1===a.length?a[0]:this.make_expression_accessor(this.expression_nodes_to_tree(a))},b.prototype.identifier=function(){var a,b="";for(a=this.white();a;){if(":"===a||"}"===a||","===a||" "===a||"]"===a||")"===a)return this.lookup(b);b+=a,a=this.next()}return this.lookup(b)},b.prototype.bindings=function(){for(var a,b={},c=this.ch;c;)a=this.name(),this.white(),c=this.next(":"),b[a]=this.expression(),this.white(),c=this.ch?this.next(","):"";return b},b.prototype.convert_to_accessors=function(b){return a.utils.objectForEach(b,function(a,c){"function"!=typeof c&&(b[a]=function(){return c})}),b},b.prototype.parse=function(a){return this.text=a,this.at=0,this.ch=" ",result=this.bindings(),this.white(),this.ch&&this.error("Syntax Error"),this.convert_to_accessors(result)},b}();return a.utils.extend(d.prototype,{registerBindings:e,nodeHasBindings:f,getBindingAccessors:g,Parser:h}),b||(a.secureBindingsProvider=d),d});