/*! knockout-secure-binding - v0.3.0 - 2014-2-1
 *  https://github.com/brianmhunt/knockout-secure-binding
 *  Copyright (c) 2014 Brian M Hunt; License: MIT */
!function(a){"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko)}(function(a,b,c){function d(a){return a>="A"&&"Z">=a||a>="a"&&"z">=a||a>="0"&&9>=a||"_"===a||"$"===a}function e(b){new a.bindingProvider;b=b||{},this.attribute=b.attribute||"data-sbind",this.noVirtualElements=b.noVirtualElements||!1,this.globals=b.globals||{},this.bindings=b.bindings||a.bindingHandlers}function f(b){a.utils.extend(this.bindings,b)}function g(a){return a.nodeType===a.ELEMENT_NODE?a.getAttribute(this.attribute):a.nodeType===a.COMMENT_NODE?!this.noVirtualElements:void 0}function h(a,b){var c,d={};return a.nodeType===a.ELEMENT_NODE?c=a.getAttribute(this.attribute):a.nodeType===a.COMMENT_NODE&&(c=a.nodeValue.replace("ko ","")),c&&(d=new l(a,b,this.globals).parse(c)),d}var i=function(){function a(a,b,c){this.token=b,this.dereferences=c,this.parser=a}function b(a,b){return b(a)}return a.prototype.lookup_value=function(a){var b=this.parser,c=b.context,d=this.token;if(a){if("function"==typeof a.get_value)a=a.get_value()[d];else if("object"==typeof a)return a[d];throw new Error("Identifier given a bad parent "+a)}switch(d){case"$element":return b.node;case"$context":return c;case"$data":return c.$data}return c&&c.$data&&Object.hasOwnProperty.call(c.$data,d)?c.$data[d]:c&&Object.hasOwnProperty.call(c,d)?c[d]:b.globals&&b.globals[d]},a.prototype.dereference=function(a){return(this.dereferences||[]).reduce(b,a)},a.prototype.get_value=function(a){return this.dereference(this.lookup_value(a))},a}(),j=function(){function b(a,b,c){this.lhs=a,this.op=b,this.rhs=c}var c={"!":function(a,b){return!b},"!!":function(a,b){return!!b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"+":function(a,b){return a+b},"-":function(a,b){return a-b},"<":function(a,b){return b>a},"<=":function(a,b){return b>=a},">":function(a,b){return a>b},">=":function(a,b){return a>=b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"&":function(a,b){return a&b},"^":function(a,b){return a^b},"|":function(a,b){return a|b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b}};return c["!"].precedence=4,c["!!"].precedence=4,c["*"].precedence=5,c["/"].precedence=5,c["%"].precedence=5,c["+"].precedence=6,c["-"].precedence=6,c["<"].precedence=8,c["<="].precedence=8,c[">"].precedence=8,c[">="].precedence=8,c["=="].precedence=9,c["!="].precedence=9,c["==="].precedence=9,c["!=="].precedence=9,c["&"].precedence=10,c["^"].precedence=11,c["|"].precedence=12,c["&&"].precedence=13,c["||"].precedence=14,b.operators=c,b.prototype.get_leaf_value=function(c,d){if("function"==typeof c)return a.unwrap(c());if("object"!=typeof c)return d?d[c]:c;if(c instanceof i||c instanceof k)return a.unwrap(c.get_value(d));if(c instanceof b)return c.get_node_value(d);throw new Error("Invalid type of leaf node: "+c)},b.prototype.get_node_value=function(){var a,b;return a=this.get_leaf_value(this.lhs),b=this.get_leaf_value(this.rhs),this.op(a,b)},b}(),k=function(){function a(a){this.nodes=a,this.root=this.build_tree(a)}return a.operators=j.operators,a.Node=j,a.prototype.build_tree=function(a){var b,c,d,e;for(c=b=new j(a.shift(),a.shift(),a.shift());a&&(d=a.shift(),e=a.shift(),d);)d.precedence>b.op.precedence?(b=new j(b,d,e),c=b):(c.rhs=new j(c.rhs,d,e),c=c.rhs);return b},a.prototype.get_value=function(){return this.root||(this.root=this.build_tree(this.nodes)),this.root.get_node_value()},a}(),l=function(){function b(a,b,c){this.node=a,this.context=b,this.globals=c||{}}function e(a){return this instanceof i||this instanceof k?a[this.get_value()]:a[this]}function f(a){return a()}var g={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},h=k.operators;return b.Expression=k,b.Identifier=i,b.Node=j,b.prototype.white=function(){for(var a=this.ch;a&&" ">=a;)a=this.next();return a},b.prototype.next=function(a){return a&&a!==this.ch&&this.error("Expected '"+a+"' but got '"+this.ch+"'"),this.ch=this.text.charAt(this.at),this.at+=1,this.ch},b.prototype.error=function(a){throw{name:"SyntaxError",message:a,at:this.at,text:this.text}},b.prototype.name=function(){var a="";for(this.white(),ch=this.ch;ch;){if(":"===ch||" ">=ch)return a;a+=ch,ch=this.next()}return a},b.prototype.number=function(){var a,b="",c=this.ch;for("-"===c&&(b="-",c=this.next("-"));c>="0"&&"9">=c;)b+=c,c=this.next();if("."===c)for(b+=".",c=this.next();c&&c>="0"&&"9">=c;)b+=c,c=this.next();if("e"===c||"E"===c)for(b+=c,c=this.next(),("-"===c||"+"===c)&&(b+=c,c=this.next());c>="0"&&"9">=c;)b+=c,c=this.next();return a=+b,isFinite(a)?a:void error("Bad number")},b.prototype.object_add_value=function(a,b,c){c instanceof i||c instanceof k?Object.defineProperty(a,b,{get:function(){return c.get_value()},enumerable:!0}):a[b]=c},b.prototype.object=function(){var a,b={},c=this.ch;if("{"===c){if(this.next("{"),c=this.white(),"}"===c)return c=this.next("}"),b;for(;c;){if(a='"'===c||"'"===c?this.string():this.name(),this.white(),c=this.next(":"),Object.hasOwnProperty.call(b,a)&&this.error('Duplicate key "'+a+'"'),this.object_add_value(b,a,this.expression()),c=this.white(),"}"===c)return c=this.next("}"),b;this.next(","),c=this.white()}}this.error("Bad object")},b.prototype.read_string=function(a){for(var b,c,d,e="",f=this.next();f;){if(f===a)return f=this.next(),e;if("\\"===f)if(f=this.next(),"u"===f){for(d=0,c=0;4>c&&(b=parseInt(f=this.next(),16),isFinite(b));c+=1)d=16*d+b;e+=String.fromCharCode(d)}else{if("string"!=typeof g[f])break;e+=g[f]}else e+=f;f=this.next()}this.error("Bad string")},b.prototype.string=function(){var a=this.ch;return'"'===a?this.read_string('"'):"'"===a?this.read_string("'"):void this.error("Bad string")},b.prototype.array=function(){var a=[],b=this.ch;if("["===b){if(b=this.next("["),this.white(),"]"===b)return b=this.next("]"),a;for(;b;){if(a.push(this.expression()),b=this.white(),"]"===b)return b=this.next("]"),a;this.next(","),b=this.white()}}this.error("Bad array")},b.prototype.value=function(){var a;switch(this.white(),a=this.ch){case"{":return this.object();case"[":return this.array();case'"':case"'":return this.string();case"-":return this.number();default:return a>="0"&&"9">=a?this.number():this.identifier()}},b.prototype.operator=function(){for(var a,b="",c=this.white();c&&!(d(c)||" ">=c||""===c||'"'===c||"'"===c||"{"===c||"["===c||"("===c);)b+=c,c=this.next();return""!==b&&(a=h[b],a||this.error("Bad operator: '"+b+"'.")),a},b.prototype.expression=function(){for(var a,b=[],d=this.white();d&&(op=this.operator(),op&&(b.push(c),b.push(op)),"("===d?(this.next(),b.push(this.expression()),this.next(")")):(a=this.value(),b.push(a)),d=this.white(),":"!==d&&"}"!==d&&","!==d&&"]"!==d&&")"!==d&&""!==d);)op=this.operator(),op&&b.push(op),d=this.white();return 0===b.length?c:1===b.length?b[0]:new k(b)},b.prototype.dereference=function(){for(var a,b=this.white();b;){if("("===b)return this.next("("),this.white(),this.next(")"),f;if("["===b)return this.next("["),a=this.expression(),this.white(),this.next("]"),e.bind(a);if("."===b){for(a="",this.next("."),b=this.white();b&&d(b);)a+=b,b=this.next();return e.bind(a)}break}},b.prototype.identifier=function(){var a,b,c="",d=[];for(a=this.white();a&&!(":"===a||"}"===a||","===a||" ">=a||"["===a||"]"===a||"("===a||")"===a||"."===a);)c+=a,a=this.next();switch(c){case"true":return!0;case"false":return!1;case"null":return null;case"undefined":return void 0}for(;a&&(b=this.dereference());)d.push(b);return new i(this,c,d)},b.prototype.bindings=function(){for(var a,b={},c=this.ch;c;)a=this.name(),this.white(),c=this.next(":"),b[a]=this.expression(),this.white(),c=this.ch?this.next(","):"";return b},b.prototype.convert_to_accessors=function(b){return a.utils.objectForEach(b,function(a,c){c instanceof i||c instanceof k?b[a]=c.get_value.bind(c):"function"!=typeof c&&(b[a]=function(){return c})}),b},b.prototype.parse=function(a){return this.text=a,this.at=0,this.ch=" ",result=this.bindings(),this.white(),this.ch&&this.error("Syntax Error"),this.convert_to_accessors(result)},b}();return a.utils.extend(e.prototype,{registerBindings:f,nodeHasBindings:g,getBindingAccessors:h,Parser:l}),b||(a.secureBindingsProvider=e),e});